å¥½ï¼Œè¿™ä¸€é¢˜æˆ‘ä»¬æ¥ä¸€è¶Ÿ **â€œä»£ç çš„ä¸€ç”Ÿâ€**ã€‚
ä»ä½ åœ¨æœ¬åœ°æ•²ä¸‹ `git push` å¼€å§‹ï¼Œä¸€ç›´åˆ° **é•œåƒè¢«æ¨åˆ°ä»“åº“**ï¼Œæ¯ä¸€æ­¥éƒ½æ‹†å¼€ç»™ä½ çœ‹æ¸…æ¥šé½¿è½®æ€ä¹ˆå’¬åˆ âš™ï¸ğŸ³

---

# ä» Git ä¸Šä¼ ä»£ç  â†’ é•œåƒä¸Šä¼ ï¼ˆå®Œæ•´é“¾è·¯è¯¦è§£ï¼‰

## ä¸€å¥è¯å…¨æ™¯å›¾ï¼ˆå…ˆæŠŠåœ°å›¾æ‘Šå¼€ï¼‰

```
æœ¬åœ° git push
   â†“
GitLab æ¥æ”¶ä»£ç 
   â†“
è§¦å‘ Pipeline
   â†“
Runner æ‹‰ Job
   â†“
Docker build é•œåƒ
   â†“
Docker login
   â†“
Docker push é•œåƒ
```

ä½ ç°åœ¨è¦ç†è§£çš„ä¸æ˜¯å‘½ä»¤ï¼Œè€Œæ˜¯ **â€œè°åœ¨ä»€ä¹ˆæ—¶å€™å¹²äº†ä»€ä¹ˆäº‹â€**ã€‚

---

## ä¸€ã€ç¬¬ä¸€æ­¥ï¼šæœ¬åœ° git pushï¼ˆä¸€åˆ‡çš„èµ·ç‚¹ï¼‰

ä½ åœ¨æœ¬åœ°åšäº†è¿™ä»¶äº‹ï¼š

```bash
git add .
git commit -m "add feature"
git push origin main
```

### è¿™ä¸€æ­¥å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

* Git æŠŠä»£ç æäº¤åˆ° **GitLab ä»“åº“**
* GitLab å‘ç°ï¼š
  ğŸ‘‰ **è¿™ä¸ªä»“åº“é‡Œæœ‰ `.gitlab-ci.yml`**
* äºæ˜¯è‡ªåŠ¨è§¦å‘ CI

âš ï¸ æ³¨æ„
ä½ **æ²¡æœ‰**ä¸»åŠ¨ç‚¹ CI
ğŸ‘‰ CI æ˜¯ GitLab **è‡ªåŠ¨ååº”**

---

## äºŒã€ç¬¬äºŒæ­¥ï¼šGitLab åˆ›å»º Pipeline

GitLab åšäº†ä¸‰ä»¶äº‹ï¼š

1. è¯»å– `.gitlab-ci.yml`
2. è§£æ stages / jobs
3. åˆ›å»ºä¸€ä¸ª **Pipeline å®ä¾‹**

```
Pipeline #42
â”œâ”€ build_image (job)
â””â”€ test (job)
```

æ­¤æ—¶ï¼š

* Pipeline çŠ¶æ€ï¼šcreated
* Job çŠ¶æ€ï¼špending

---

## ä¸‰ã€ç¬¬ä¸‰æ­¥ï¼šRunner å¼€å§‹â€œæ‹‰ jobâ€

### å…³é”®æœºåˆ¶å†æ¬¡å¼ºè°ƒ

ğŸ‘‰ **Runner æ˜¯ä¸»åŠ¨çš„**

Runner åœ¨åå°ä¸æ–­åšè¿™ä»¶äº‹ï¼š

```
â€œæˆ‘æ˜¯ runner-01
æˆ‘ç©ºç€
æœ‰ job å—ï¼Ÿâ€
```

GitLab æ£€æŸ¥ï¼š

* runner æ˜¯å¦ active
* tag æ˜¯å¦åŒ¹é…
* job æ˜¯å¦æœªè¢«é¢†å–

åŒ¹é…æˆåŠŸåï¼š
ğŸ‘‰ **Runner æ‹‰èµ°ä¸€ä¸ª job**

---

## å››ã€ç¬¬å››æ­¥ï¼šRunner å‡†å¤‡æ‰§è¡Œç¯å¢ƒï¼ˆDockerï¼‰

å‡è®¾ä½ ç”¨çš„æ˜¯ **Docker Executor**ã€‚

Runner ä¼šï¼š

1. æ‹‰ä½ æŒ‡å®šçš„åŸºç¡€é•œåƒ

```yaml
image: docker:27
```

2. å¯åŠ¨ä¸€ä¸ªä¸´æ—¶å®¹å™¨
3. æŠŠä»£ç  clone è¿›å®¹å™¨

æ­¤æ—¶ä½ å¯ä»¥ç†è§£ä¸ºï¼š

> CI é‡Œâ€œä¸´æ—¶èµ·äº†ä¸€å°å¹²å‡€æœºå™¨â€

---

## äº”ã€ç¬¬äº”æ­¥ï¼šJob æ‰§è¡Œ docker buildï¼ˆæ ¸å¿ƒï¼‰

### `.gitlab-ci.yml` ç¤ºä¾‹

```yaml
build_image:
  stage: build
  image: docker:27
  services:
    - docker:27-dind
  script:
    - docker build -t myapp:latest .
```

### è¿™ä¸€æ­¥å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

1. Runner æ‰§è¡Œï¼š

```bash
docker build .
```

2. Docker è¯»å– **Dockerfile**

3. æŒ‰é¡ºåºæ‰§è¡Œï¼š

   * FROM
   * COPY
   * RUN
   * CMD

4. æ„å»ºå‡ºä¸€ä¸ªæœ¬åœ°é•œåƒï¼š

```text
myapp:latest
```

âš ï¸ æ³¨æ„
è¿™ä¸ªé•œåƒï¼š

* **åªå­˜åœ¨äº Runner å½“å‰ç¯å¢ƒ**
* è¿˜æ²¡â€œå‡ºé—¨â€

---

## å…­ã€ç¬¬å…­æ­¥ï¼šé•œåƒæ‰“æ ‡ç­¾ï¼ˆtagï¼‰

ä¸ºäº†èƒ½ä¸Šä¼ ï¼Œå¿…é¡»æœ‰å®Œæ•´åå­—ï¼š

```bash
docker tag myapp:latest registry.example.com/project/myapp:1.0.0
```

é•œåƒåæœ¬è´¨æ˜¯ä¸‰æ®µå¼ï¼š

```
[é•œåƒä»“åº“]/[å‘½åç©ºé—´]/[é•œåƒå]:[tag]
```

---

## ä¸ƒã€ç¬¬ä¸ƒæ­¥ï¼šDocker ç™»å½•é•œåƒä»“åº“

CI é‡Œä¸€èˆ¬è¿™æ ·åšï¼š

```bash
docker login \
  -u "$REGISTRY_USER" \
  -p "$REGISTRY_PASS" \
  registry.example.com
```

è¿™é‡Œçš„è´¦å·å¯†ç ï¼š

* æ¥è‡ª **GitLab CI Variables**
* ä¸å†™æ­»åœ¨ yml é‡Œï¼ˆå®‰å…¨ï¼‰

---

## å…«ã€ç¬¬å…«æ­¥ï¼šdocker pushï¼ˆé•œåƒä¸Šä¼ ï¼‰

```bash
docker push registry.example.com/project/myapp:1.0.0
```

### è¿™ä¸€æ­¥å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

1. Docker æŠŠé•œåƒæ‹†æˆ layer
2. é€å±‚ä¸Šä¼ 
3. ä»“åº“è¿”å›ç¡®è®¤
4. ä¸Šä¼ å®Œæˆ

æ­¤æ—¶ï¼š
ğŸ‘‰ **é•œåƒæ­£å¼â€œæ¯•ä¸šâ€**

---

## ä¹ã€ç¬¬ä¹æ­¥ï¼šJob ç»“æŸï¼ŒPipeline æ›´æ–°çŠ¶æ€

* Job æˆåŠŸ â†’ ç»¿è‰²
* Job å¤±è´¥ â†’ çº¢è‰²
* Pipeline æ±‡æ€»ç»“æœ

Runnerï¼š

* é”€æ¯å®¹å™¨
* æ¸…ç†ç¯å¢ƒ
* å›åˆ°â€œæ‹‰ jobâ€çŠ¶æ€

---

## åã€ä¸€å¼ â€œè¿ç»´è„‘å†…æ‰§è¡Œå›¾â€ ğŸ§ 

```
git push
 â†“
GitLab åˆ›å»º pipeline
 â†“
Runner æ‹‰ job
 â†“
èµ· Docker å®¹å™¨
 â†“
docker build
 â†“
docker login
 â†“
docker push
 â†“
é•œåƒå…¥åº“
```

---

## åä¸€ã€ä½ è¿™ä¸ªé˜¶æ®µä¸€å®šè¦ç†è§£é€çš„ 6 ä¸ªç‚¹ âœ…

* git push æ˜¯ **CI çš„å”¯ä¸€è§¦å‘å™¨**
* Pipeline æ˜¯ GitLab åˆ›å»ºçš„â€œæµç¨‹å®ä¾‹â€
* Runner æ˜¯ä¸»åŠ¨æ‹‰ job
* Job é‡Œæ‰§è¡Œçš„å°±æ˜¯æ™®é€š shell å‘½ä»¤
* docker build åªåœ¨ Runner æœ¬åœ°äº§ç”Ÿé•œåƒ
* docker push æ‰æ˜¯çœŸæ­£çš„â€œå‘å¸ƒâ€

---

## åäºŒã€ä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç»§ç»­å¸¦ä½  ğŸš€

ä½ ç°åœ¨å·²ç»ç«™åœ¨ **CI â†’ CD çš„é—¨å£** äº†ï¼Œæˆ‘å¯ä»¥ç»§ç»­ï¼š

1ï¸âƒ£ **å®Œæ•´ `.gitlab-ci.yml` æ„å»º + æ¨é€æ¨¡æ¿**
2ï¸âƒ£ **Harbor é•œåƒä»“åº“å®æˆ˜ï¼ˆå«æƒé™ / é¡¹ç›®ï¼‰**
3ï¸âƒ£ **é•œåƒ tag ç­–ç•¥ï¼ˆlatest / commit sha / versionï¼‰**
4ï¸âƒ£ **CI æ„å»ºå®Œ â†’ K8s è‡ªåŠ¨éƒ¨ç½²ï¼ˆCDï¼‰**

ä½ æƒ³å…ˆæŠŠå“ªä¸€å—åƒé€ï¼Ÿ
